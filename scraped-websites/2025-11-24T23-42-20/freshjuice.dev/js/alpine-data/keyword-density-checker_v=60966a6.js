(()=>{var h=(...t)=>{(location.hostname.match("local")||window.sessionStorage.unicorn)&&console.log("\u{1F984}:",...t)};function c(t){return String(t??"").replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim()}var y=new Set(["a","an","the","and","or","but","if","then","else","when","at","by","for","from","in","into","of","on","onto","to","up","with","as","is","are","was","were","be","been","being","it","its","that","this","these","those","i","you","he","she","they","we","me","him","her","them","us","my","your","his","their","our","mine","yours","hers","theirs","ours","so","not","no","yes","do","does","did","doing","have","has","had","having","over","under","too","very","can","could","should","would","will","just"]);function m(t){return String(t??"").replace(/\s+/g," ").trim()}function S(t){return m(c(t||"")).split(/\s*;\s*/).map(n=>n.trim()).filter(Boolean)}function d(t){let e=c(String(t??"")),n=/[\p{L}\p{M}\p{Nd}']+/gu,r=[],s;for(;(s=n.exec(e))!==null;)r.push(s[0].toLowerCase());return r}function b(t){return t.filter(e=>!y.has(e))}function f(t){let e=new Map;for(let n of t)e.set(n,(e.get(n)||0)+1);return e}function k(t,e){if(!e.length)return 0;let n=0,r=e.length;for(let s=0;s<=t.length-r;s++){let o=!0;for(let i=0;i<r;i++)if(t[s+i]!==e[i]){o=!1;break}o&&n++}return n}function w(t,e){return e?t/e*100:0}function p(t){return Math.round(t*100)/100}function L(t,e,n){let r=f(t),s=[];for(let o of n){let i=o.toLowerCase(),a=d(i);if(a.length===0)continue;let l=0,u=0;a.length===1?(l=r.get(a[0])||0,u=l):(l=k(t,a),u=l*a.length);let g=w(u,e);s.push({term:o,words:a,occurrences:l,tokenShareCount:u,density:p(g)})}return s.sort((o,i)=>i.density-o.density||i.occurrences-o.occurrences||o.term.localeCompare(i.term)),s}function R(t,e,n=20){let r=Array.from(t.entries()).map(([s,o])=>({word:s,count:o,density:p(w(o,e))}));return r.sort((s,o)=>o.density-s.density||o.count-s.count||s.word.localeCompare(o.word)),r.slice(0,n)}function x(t){return t>=3?{label:">= 3% (risk of stuffing)",level:"high"}:t>=1&&t<=2?{label:"1\u20132% (optimal)",level:"optimal"}:t>0?{label:"< 1%",level:"low"}:{label:"0%",level:"none"}}document.addEventListener("alpine:init",()=>{Alpine.data("KeywordDensityChecker",()=>({state:"idle",buttonLabel:"Analyze Density",errorMessage:"",showResults:!1,inputText:"",keywordsRaw:"",excludeStopwords:!0,totalWords:0,uniqueWords:0,wordMap:new Map,topSingles:[],keywordStats:[],setButtonLabel(){switch(this.state){case"analyzing":this.buttonLabel="Analyzing\u2026";break;case"success":this.buttonLabel="Analyze Again";break;case"error":this.buttonLabel="Try Again";break;default:this.buttonLabel="Analyze Density"}},reset(){this.inputText="",this.keywordsRaw="",this.excludeStopwords=!0,this.state="idle",this.errorMessage="",this.showResults=!1,this.totalWords=0,this.uniqueWords=0,this.wordMap=new Map,this.topSingles=[],this.keywordStats=[],this.setButtonLabel()},analyze(t){t&&typeof t.preventDefault=="function"&&t.preventDefault(),this.errorMessage="";let e=S(this.keywordsRaw),n=d(this.inputText),r=n;if(this.excludeStopwords&&(r=b(n)),this.totalWords=r.length,this.totalWords===0){this.state="error",this.setButtonLabel(),this.errorMessage="Please paste some text to analyze.",this.showResults=!1;return}this.state="analyzing",this.setButtonLabel(),this.showResults=!1;try{let s=f(r);this.wordMap=s,this.uniqueWords=s.size,this.topSingles=R(s,this.totalWords,20),this.keywordStats=L(r,this.totalWords,e).map(i=>({...i,classification:x(i.density)})),this.state="success",this.setButtonLabel(),this.showResults=!0;let o=new URLSearchParams;e.length&&o.set("kw",e.join("; ")),this.excludeStopwords||o.set("stop","0"),history.replaceState({},"",`${location.pathname}?${o.toString()}`),h(`Density: words=${this.totalWords}, unique=${this.uniqueWords}, kw=${e.length}`)}catch(s){console.error(s),this.state="error",this.setButtonLabel(),this.errorMessage=s?.message||"Something went wrong. Please try again.",this.showResults=!1}},init(){h("Keyword Density Checker initialized");let t=new URLSearchParams(location.search),e=t.get("kw"),n=t.get("stop");e&&(this.keywordsRaw=e),n==="0"&&(this.excludeStopwords=!1)}}))});})();
