(()=>{var a=(...t)=>{(location.hostname.match("local")||window.sessionStorage.unicorn)&&console.log("\u{1F984}:",...t)};function d(t){return String(t??"").replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim()}document.addEventListener("alpine:init",()=>{Alpine.data("SeoAnalyzer",()=>({url:"",result:null,metadata:null,errorMessage:"",state:"idle",buttonLabel:"Analyze SEO",openIndex:[],options:{checkSemantics:!0,checkSchemas:!0,checkHeadings:!0,checkMeta:!0,checkAccessibility:!0,checkRobots:!0},get analyzedAtLocal(){if(!this.result||!this.result.analyzedAt)return"";try{return new Date(this.result.analyzedAt).toLocaleString()}catch{return String(this.result.analyzedAt)}},get robotsFlags(){if(!this.result||!this.result.meta)return"";let t=this.result.meta,e=[];return t.isNoIndex&&e.push("noindex"),t.isNoFollow&&e.push("nofollow"),e.length?e.join(", "):"index, follow"},get jsonldPretty(){if(!this.result||!this.result.schemas||!this.result.schemas.jsonld)return"";try{return JSON.stringify(this.result.schemas.jsonld,null,2)}catch{return""}},get hasRobotsTxtData(){return!!(this.result&&this.result.robotsTxt)},get robotsTxtStatus(){let t=this.result&&this.result.robotsTxt;return t?{hasFile:!!t.hasRobotsTxt,hasLlmsTxt:!!t.hasLlmsTxt,allowsCrawling:!!t.robotsAllowsCrawling,hasSitemap:!!t.hasSitemap,hasUserAgent:!!t.hasUserAgent,robotsTxtUrl:t.robotsTxtUrl||"",llmsTxtUrl:t.llmsTxtUrl||"",issues:Array.isArray(t.issues)?t.issues:[],warnings:Array.isArray(t.warnings)?t.warnings:[]}:null},get sortedRecommendations(){if(!this.result||!Array.isArray(this.result.recommendations))return[];let t={critical:0,high:1,medium:2,low:3};return[...this.result.recommendations].sort((e,r)=>{let s=t[(e.severity||"").toLowerCase()]??99,i=t[(r.severity||"").toLowerCase()]??99;return s!==i?s-i:(e.title||"").localeCompare(r.title||"")})},get missingSchemasList(){let t=this.result&&this.result.schemas;if(!t||t.missing==null)return[];let e=t.missing;return Array.isArray(e)?e.map(r=>({name:r})):typeof e=="object"?Object.keys(e).map(r=>{let s=e[r]||{};return{name:r,schemaUrl:typeof s.schemaUrl=="string"?s.schemaUrl:null,jsonLdExample:typeof s.jsonLdExample=="object"&&s.jsonLdExample!==null||typeof s.jsonLdExample=="string"?s.jsonLdExample:null}}):[]},hasSchemaExample(t){if(!t)return!1;let e=t.jsonLdExample;return typeof e=="string"?e.trim().length>0:e&&typeof e=="object"?Object.keys(e).length>0:!1},jsonLdExamplePretty(t){if(!t||t.jsonLdExample==null)return"";let e=t.jsonLdExample;try{if(typeof e=="object")return JSON.stringify(e,null,2);if(typeof e=="string")try{let r=JSON.parse(e);return JSON.stringify(r,null,2)}catch{return e}}catch{}return String(e)},missingKey(t){return`missing:${String(t||"").trim()}`},bool(t){return t?"\u2705":"\u274C"},severityLabel(t){let e=(t||"").toLowerCase();return e==="critical"?"Critical":e==="high"?"High":e==="medium"?"Medium":"Low"},severityBadge(t){switch((t||"").toLowerCase()){case"critical":return"border-red-300 bg-red-50 text-red-700";case"high":return"border-orange-300 bg-orange-50 text-orange-700";case"medium":return"border-yellow-300 bg-yellow-50 text-yellow-700";default:return"border-blue-300 bg-blue-50 text-blue-700"}},escapeCode(t){return t==null?"":String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")},highlightPrism(){try{window.Prism&&typeof window.Prism.highlightAll=="function"&&window.Prism.highlightAll()}catch{}},hasRecDetails(t){if(!t)return!1;let e=t.code;return typeof e=="string"?e.trim().length>0:!!e},get scoreCardClass(){let t=this.result&&typeof this.result.score=="number"?this.result.score:0;return t>=90?"border-green-200 bg-green-50":t>=75?"border-blue-200 bg-blue-50":t>=50?"border-yellow-200 bg-yellow-50":"border-red-200 bg-red-50"},get scoreBadgeClass(){let t=this.result&&typeof this.result.score=="number"?this.result.score:0;return t>=90?"border-green-300 bg-green-100 text-green-700":t>=75?"border-blue-300 bg-blue-100 text-blue-700":t>=50?"border-yellow-300 bg-yellow-100 text-yellow-700":"border-red-300 bg-red-100 text-red-700"},toggleOpen(t){this.openIndex=this.openIndex.includes(t)?this.openIndex.filter(e=>e!==t):[...this.openIndex,t],this.$nextTick?this.$nextTick(()=>this.highlightPrism()):setTimeout(()=>this.highlightPrism(),0)},copy(t){t&&navigator.clipboard?.writeText(t).then(()=>{a("Copied to clipboard")},()=>{})},downloadJson(){if(this.result)try{let t={...this.metadata||{},...this.result},e=JSON.stringify(t),r=new Blob([e],{type:"application/json"}),i=(this.result.url||this.url||"website").replace(/^https?:\/\//,"").split("/")[0].replace(/\W/g,"-"),n=new Date().toISOString(),o=n.split("T")[0],c=n.split("T")[1].split(".")[0].replace(/:/g,"-"),h=`freshjuice-seo-analysis_${i}_${o}_${c}.json`,u=URL.createObjectURL(r),l=document.createElement("a");l.href=u,l.download=h,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(u),a(`Downloaded JSON: ${h}`)}catch(t){a("Failed to download JSON:",t)}},reset(){this.result=null,this.metadata=null,this.errorMessage="",this.state="idle",this.openIndex=[],this.buttonLabel="Analyze SEO"},normalizeHttps(t){if(t=String(t||"").trim(),!t)return"";try{let r=new URL(t,/^https?:\/\//i.test(t)?void 0:"https://"),s=r.host,i=r.pathname+(r.search||"")+(r.hash||"");if(!s&&r.href.startsWith("https://")){let n=r.href.replace("https://","");if(/^\/?\S/.test(n))return`https://${n.replace(/^\//,"")}`}if(s)return`https://${s}${i}`}catch{}let e=t.replace(/^\s*https?:\/\//i,"").replace(/^\/*/,"");return e?`https://${e}`:""},sanitizeUrlHttps(t){t=d(t);let e=this.normalizeHttps(t);try{let r=new URL(e);return r.protocol!=="https:"||!r.host?"":r.toString()}catch{return""}},encodedUrl(){let t=this.result&&this.result.url?this.result.url:this.url,e=this.sanitizeUrlHttps(t||"");if(!e)return"";try{return encodeURIComponent(e)}catch{return""}},buildToolLink(t){let e=this.encodedUrl();if(!e)return"";let s={"metadata-checker":"/tools/metadata-checker/","heading-extractor":"/tools/heading-extractor/"}[t]||t||"";if(!s)return"";let i=s.includes("?")?"&":"?";return`${s}${i}url=${e}`},onUrlInput(t=!1){let e=String(this.url||""),r=this.normalizeHttps(e);if(!t){this.url=r;return}let s=this.sanitizeUrlHttps(r);this.url=s||r},async analyze(t){t&&t.preventDefault(),this.errorMessage="";let e=this.sanitizeUrlHttps(this.url);if(!e){this.errorMessage="Please enter a valid absolute HTTPS URL (must start with https://).",this.state="error";return}this.url=e,this.state="loading",this.buttonLabel="Analyzing\u2026";try{let r=new AbortController,s=setTimeout(()=>r.abort(),15e3),i=await fetch("https://api.freshjuice.dev/seo-analyzer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:this.url,options:{checkSemantics:!!this.options.checkSemantics,checkSchemas:!!this.options.checkSchemas,checkHeadings:!!this.options.checkHeadings,checkMeta:!!this.options.checkMeta,checkAccessibility:!!this.options.checkAccessibility,checkRobots:!!this.options.checkRobots}}),signal:r.signal});if(clearTimeout(s),!i.ok){let o={};try{o=await i.json()}catch{}let c=o&&(o.error||o.message)||`Upstream error (status ${i.status})`;throw new Error(c)}let n=await i.json();if(!n||n.success===!1){let o=n&&(n.error||n.message)?n.error||n.message:"Unexpected API response";throw new Error(o)}this.metadata={generatedBy:n.generatedBy||null,toolUrl:n.toolUrl||null,aiAssistantPrompt:n.aiAssistantPrompt||null},this.result=n.data||null,this.state="success",this.buttonLabel="Analyze again",this.$nextTick?this.$nextTick(()=>this.highlightPrism()):setTimeout(()=>this.highlightPrism(),0)}catch(r){a(r);let s=String(r&&r.message?r.message:r);this.errorMessage=this.mapError(s),this.state="error",this.buttonLabel="Try again"}},mapError(t){return/Invalid URL/i.test(t)?"Invalid URL format (must be absolute HTTPS starting with https://).":/not html/i.test(t)?"Target is not HTML (unsupported content type).":/reachable/i.test(t)?"URL not reachable. Check the address and try again.":/Blocked host/i.test(t)?"The host is blocked.":/Invalid JSON body/i.test(t)?"Internal error: invalid JSON body sent.":/timeout|abort/i.test(t)?"Fetch timeout. The request took too long.":/Upstream error/i.test(t)?t:t||"Something went wrong. Please try again."},init(){a("SEO Analyzer initialized");try{let e=new URLSearchParams(location.search).get("url");if(e){let r=this.sanitizeUrlHttps(e);r?(this.url=r,this.$nextTick?this.$nextTick(()=>this.analyze()):setTimeout(()=>this.analyze(),0)):this.url=String(e).trim()}}catch{}}}))});})();
